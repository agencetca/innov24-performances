<!DOCTYPE HTML>

<html>
	<head>
		<meta charset='utf-8'/>
		<title>Innov24 Performances</title>
		<link rel="stylesheet" type="text/css" href="index.css"></link>

		<!-- Google connect -->
		<script src="https://apis.google.com/js/platform.js" async defer></script>
		<meta name="google-signin-client_id" content="884865850203-9rv0ddf6fk0opos6hf9mn958mlcar741.apps.googleusercontent.com">

	</head>
	<body>
		
		<div id="main">
			<div id="logo">
			<img src="logo.png"/>
			</div>
			<div id="hours">00</div>
			<div>:</div>
			<div id="minutes">00</div>
			<div>:</div>
			<div id="seconds">00</div>

			<div class="g-signin2" data-onsuccess="onSignIn"></div>

			<div id="users">
				<input placeholder="Current Task" type="text"></input>
				<!--ul>
					<li><div title="" class="item">Erick<div></li>
					<li><div title="Gantt Technique" class="item">Guillaume<div></li>
				</ul-->
			</div>
		</div>

	<!-- The core Firebase JS SDK is always required and must be listed first -->
	<script src="https://www.gstatic.com/firebasejs/7.2.3/firebase-app.js"></script>

	<script src="https://www.gstatic.com/firebasejs/7.2.3/firebase-auth.js"></script>
        <script src="https://www.gstatic.com/firebasejs/7.2.3/firebase-database.js"></script>

	<!-- TODO: Add SDKs for Firebase products that you want to use
	 https://firebase.google.com/docs/web/setup#available-libraries -->
	 <script src="https://www.gstatic.com/firebasejs/7.2.3/firebase-analytics.js"></script>

	<script>
		const hours = document.getElementById('hours')
		const minutes = document.getElementById('minutes')
		const seconds = document.getElementById('seconds')

		let h = hours.innerHTML || 0
		let m = minutes.innerHTML || 0
		let s = seconds.innerHTML || 0

		window.setInterval(() => {

			if (h < 23 && m == 59 && s == 59) {
				h++
			} else if (h == 23 && m == 59 && s == 59) {
				h = 0
			}

			if (m < 59 && s == 59) {
				m++
			} else if (m == 59 && s == 59) {
				m = 0
			}

			if (s < 59) {
				s++
			} else {
				s = 0
				updateTime();
			}

			hours.innerHTML = ("0" + h).slice(-2)
			minutes.innerHTML = ("0" + m).slice(-2)
			seconds.innerHTML = ("0" + s).slice(-2)

		}, 1000)

		let profile = null;
		let dbuser = null

		// Your web app's Firebase configuration

		const firebaseConfig = {
		       apiKey: "AIzaSyAwLXckrroTUjaS8h6-rjaX9EfBI3EShm0",
		       authDomain: "innov24-performances.firebaseapp.com",
		       databaseURL: "https://innov24-performances.firebaseio.com",
		       projectId: "innov24-performances",
		       storageBucket: "innov24-performances.appspot.com",
	               messagingSenderId: "75780825100",
		       appId: "1:75780825100:web:c91296634ac3ee61dd0e29",
		       measurementId: "G-EZP9D6WF08"
		};

		// Initialize Firebase
		firebase.initializeApp(firebaseConfig);
		firebase.analytics();

		firebase.auth().onAuthStateChanged(function(user) {
		  if (user) {
		    // User is signed in.
	 	    dbuser = user
		  }
		});

		function onSignIn(googleUser) {
		    profile = googleUser.getBasicProfile();
		}

		function writeUserData(userId, name, email, imageUrl, times) {

		  // Get a reference to the database service
		  firebase.database().ref('users/' + userId).set({
		    username: name,
		    email: email,
		    profile_picture : imageUrl,
		    hours : times.hours,
	            minutes : times.minutes,
	 	    seconds : times.seconds
		  });

		};

		function updateTime() {

			if (profile && profile.getName(), profile.getEmail(), profile.getImageUrl() && profile.getId()) {

			  const times = {
				hours : h,
				minutes : m,
				seconds : s
			  }

			  const userId = firebase.auth().currentUser.uid;
			  writeUserData(userId, profile.getName(), profile.getEmail(), profile.getImageUrl(), times);
			}
		}

	 </script>

	</body>
</html>
